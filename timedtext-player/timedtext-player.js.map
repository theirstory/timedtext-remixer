{"version":3,"file":"timedtext-player.js","sourceRoot":"","sources":["../src/timedtext-player.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable prefer-const */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {LitElement, css} from 'lit';\nimport {html, unsafeStatic} from 'lit/static-html.js';\nimport {customElement, state, property, queryAll} from 'lit/decorators.js';\n\nimport {finder} from '@medv/finder';\n\nimport {interpolate} from './utils';\nimport {Clip, Gap, TimedText, Track, Effect} from './interfaces';\n\n\n// class TextTrack {\n//   constructor(players: NodeListOf<HTMLMediaElement>) {\n//     this._players = players;\n//   }\n\n//   _players: NodeListOf<HTMLMediaElement>;\n\n//   _mode = 'showing' as TextTrackMode;\n\n//   get mode(): TextTrackMode {\n//     return this._mode;\n//   }\n\n//   set mode(mode: TextTrackMode) {\n//     console.log(`setting mode to ${mode}`, this._players);\n//     this._mode = mode;\n//     this._players.forEach((p) => {\n//       const track = p.textTracks[0];\n//       if (track) track.mode = mode;\n//     });\n//   }\n// }\n\n@customElement('timedtext-player')\nexport class TimedTextPlayer extends LitElement {\n  static override styles = document.location.href.indexOf('debug') > 0 ? css`\n    :host {\n      display: block;\n    }\n    .active {\n      outline: 4px solid red;\n      /* display: block !important; */\n    }\n    *[data-t] {\n      margin: 10px;\n    }\n    .wrapper {\n      position: relative;\n      display: inline-block;\n      /* display: none; */\n      color: white;\n    }\n    video {\n      /* width: 640px; */\n    }\n    video::cue(.yellow) {\n      color: yellow;\n    }\n    ::cue:past {\n      color: white;\n    }\n    ::cue:future {\n      color: grey;\n    }\n  ` : css`\n  :host {\n      display: block;\n    }\n    .active {\n      /* outline: 4px solid red; */\n      display: block !important;\n    }\n    *[data-t] {\n      /* margin: 10px; */\n    }\n    .wrapper {\n      position: relative;\n      /* display: inline-block; */\n      display: none;\n      color: white;\n    }\n    video {\n      width: 320px;\n    }\n  `;\n\n  @property({type: Number})\n  width: number | undefined;\n\n  @property({type: Number})\n  height: number | undefined;\n\n\n  @state()\n  time = 0;\n\n  set currentTime(time: number) {\n    this._seek(time);\n    // cancel end\n    this._end = this._duration;\n  }\n\n  get currentTime() {\n    return this.time;\n  }\n\n  set currentPseudoTime(time: number) {\n    this._dispatchTimedTextEvent(time);\n  }\n\n  get seeking() {\n    const players = Array.from(this._players);\n    return players.some((p) => p.seeking);\n  }\n\n  @state()\n  playing = false;\n\n  get paused() {\n    return !this.playing;\n  }\n\n  public play() {\n    const player = this._currentPlayer();\n    if (!player) return;\n    player.play();\n  }\n\n  public pause() {\n    const player = this._currentPlayer();\n    if (!player) return;\n    player.pause();\n  }\n\n  @state()\n  _duration = 0;\n\n  get duration() {\n    return this._duration;\n  }\n\n  _muted = false;\n\n  set muted(muted: boolean) {\n    this._players.forEach((p) => p.muted = muted);\n    this._muted = muted;\n  }\n\n  get muted() {\n    return this._muted;\n  }\n\n  _volume = 1;\n\n  get volume() {\n    return this._volume;\n  }\n\n  set volume(volume: number) {\n    this._players.forEach((p) => p.volume = volume);\n  }\n\n  @state()\n  track: Track | null = null;\n\n  @queryAll('*[data-t]') // TODO make it work with all players?\n  _players!: NodeListOf<HTMLMediaElement>;\n\n  _playersReady: HTMLMediaElement[] = [];\n\n  // private isPlayerReady(player: HTMLMediaElement) {\n  //   return this._playersReady.includes(player);\n  // }\n\n\n  // textTracks: TextTrack[] = [];\n\n  _playersEventsCounter: Map<HTMLMediaElement, Record<string, number>> = new Map();\n\n  get playersEventsCounter() {\n    return Array.from(this._playersEventsCounter.entries()).map(([player, eventsCounter]) => {\n      return {player, eventsCounter};\n    });\n  }\n\n  // const sections: NodeListOf<HTMLElement> | undefined = article.querySelectorAll('section[data-media-src]');\n  private _dom2otio(sections: NodeListOf<HTMLElement> | undefined) {\n    if (!sections) return;\n\n    this.track = {\n      OTIO_SCHEMA: 'Track.1',\n      name: 'Transcript',\n      kind: 'Video',\n      children: Array.from(sections).map((s): Clip => {\n        const src = s.getAttribute('data-media-src');\n        const [start, end] = (s.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n\n        const children: NodeListOf<HTMLElement> | undefined = s.querySelectorAll('p[data-t]:not(*[data-effect]), div[data-t]:not(*[data-effect])');\n        const effects: NodeListOf<HTMLElement> | undefined = s.querySelectorAll('div[data-t][data-effect]');\n\n        return {\n          OTIO_SCHEMA: 'Clip.1', // TODO: verify with OTIO spec, should be Composable?\n          source_range: {\n            start_time: start,\n            duration: end - start\n          },\n          media_reference: {\n            OTIO_SCHEMA: 'MediaReference.1',\n            target: src,\n          },\n          metadata: {\n            element: s,\n            selector: finder(s, {root: s.parentElement as HTMLElement}),\n            playerTemplateSelector: s.getAttribute('data-player'),\n            data: s.getAttributeNames().filter(n => n.startsWith('data-')).reduce((acc, n) => ({...acc, [n.replace('data-', '').replace('-', '_')]: s.getAttribute(n)}), {}),\n          },\n          children: Array.from(children).map((c): Clip | Gap => {\n            const [start, end] = (c.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n            const children: NodeListOf<HTMLElement> | undefined = c.querySelectorAll('*[data-t],*[data-m]');\n            const segmenter = new (Intl as any).Segmenter('en', { granularity: 'sentence' }); // TODO language detection? from page?\n            // const text = c.textContent ?? ''; // TBD this has a lot of whitespace and might have non timed text?\n            const text = Array.from(children).map((t) => t.textContent).join(' '); // TBD this is the timed text only\n            const sentences = [...segmenter.segment(text)[Symbol.iterator]()].map(({index, segment: text}) => ({index, text}));\n\n            return {\n              OTIO_SCHEMA: 'Clip.1',\n              source_range: {\n                start_time: start,\n                duration: end - start\n              },\n              media_reference: {\n                OTIO_SCHEMA: 'MediaReference.1',\n                target: src,\n              },\n              metadata: {\n                element: c,\n                transcript: c.textContent,\n                selector: finder(c, {root: s.parentElement as HTMLElement}),\n                data: c.getAttributeNames().filter(n => n.startsWith('data-')).reduce((acc, n) => ({...acc, [n.replace('data-', '').replace('-', '_')]: c.getAttribute(n)}), {}),\n                text,\n                sentences,\n              },\n              timed_texts: Array.from(children).map((t, i, arr) => {\n                let start, end;\n                if (t.getAttribute('data-t')) {\n                  const f = (t.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n                  start = f[0];\n                  end = f[1];\n                } else {\n                  start = parseFloat(t.getAttribute('data-m') ?? '') / 1e3;\n                  end = start + parseFloat(t.getAttribute('data-d') ?? '') / 1e3;\n                }\n\n                const prefix = arr.slice(0, i).map((t) => t.textContent ?? '').join(' ') + (i > 0 ? ' ' : '');\n                const textOffset = prefix.length;\n                const text = (t.textContent ?? '');\n                const sentence = Array.from(sentences).reverse().find(({index}) => textOffset >= index);\n                const sos = sentence?.index === textOffset;\n                const eos = sentence?.index + sentence?.text.trim().length === textOffset + text.length;\n                const punct = !!text.trim().charAt(text.length - 1).match(/\\p{P}/gu);\n\n                return {\n                  OTIO_SCHEMA: 'TimedText.1',\n                  marked_range: {\n                    start_time: start,\n                    duration: end - start\n                  },\n                  texts: t.textContent ?? '',\n                  style_ids: [],\n                  metadata: {\n                    element: t,\n                    selector: finder(t, {root: s.parentElement as HTMLElement}),\n                    textOffset,\n                    sos,\n                    eos,\n                    length: text.length,\n                    punct,\n                    // ruby: `<ruby>${text}<rt>${eos ? 'eos ' : ''}${sos ? 'sos ' : ''}${punct ? 'punct ' : ''}</rt></ruby>`,\n                    ruby: `<ruby>${text}</ruby>`, // FIXME\n                  },\n                } as unknown as TimedText;\n              }),\n              effects: [],\n            } as unknown as Clip;\n          }) //\n          .map((p) => {\n            const tt = (p as Clip).timed_texts ?? [];\n\n            tt.forEach((t, i, arr) => {\n              if (i === 0) return;\n              const prev = arr[i - 1];\n              if (t.metadata.sos) prev.metadata.eos = true;\n            });\n\n            tt.forEach((t, i, arr) => {\n              if (i === 0) {\n                t.metadata.lastBreak = 0;\n                t.metadata.captionGroup = `c${p.source_range.start_time}-${t.metadata.lastBreak}`;\n                return;\n              }\n\n              t.metadata.lastBreak = arr[i - 1].metadata.lastBreak;\n              t.metadata.captionGroup = `c${p.source_range.start_time}-${t.metadata.lastBreak}`;\n\n              if (t.metadata.textOffset + t.metadata.length - t.metadata.lastBreak >= 37 * 2 || i === arr.length - 1) {\n                const candidates = arr.slice(i - 5 < 0 ? 0 : i - 5, i);\n\n                // find previous punctuation\n                let item =\n                  candidates.reverse().find(({metadata: { eos }}) => eos) ?? candidates.find(({metadata: { punct }}) => punct) ?? t;\n                item.metadata.pilcrow0 = true;\n\n                //  avoid widows\n                if (i < tt.length - 5) {\n                  // look ahead 2 items for punctuation\n                  item = tt.slice(i, i + 3).find(({metadata: { punct }}) => punct) ?? t;\n                  item.metadata.pilcrow2 = true;\n                } else if (i >= tt.length - 5) {\n                  // we have few items left, use first candidates (eos, punct)\n                  item = tt.slice(i).find(({metadata: { eos }}) => eos) ?? candidates.find(({metadata: { punct }}) => punct) ?? t;\n                  item.metadata.pilcrow3 = true;\n                }\n\n                t.metadata.pilcrow = true;\n                t.metadata.lastBreak = t.metadata.textOffset + t.metadata.length + 1;\n                // item.metadata.lastBreak = item.metadata.textOffset + item.metadata.length + 1;\n              }\n            });\n\n            return p;\n          }).reduce((acc, c, i, arr) => {\n            if (i === 0 || i === arr.length - 1) return [...acc, c];\n            const prev = arr[i - 1];\n            if (c.source_range.start_time === prev.source_range.start_time + prev.source_range.duration) return [...acc, c];\n            const gap = { // TODO TBD if this is gap or speechless clip?\n              OTIO_SCHEMA: 'Gap.1',\n              source_range: {\n                start_time: prev.source_range.start_time + prev.source_range.duration,\n                duration: c.source_range.start_time - (prev.source_range.start_time + prev.source_range.duration)\n              },\n              media_reference: {\n                OTIO_SCHEMA: 'MediaReference.1',\n                target: src,\n              }\n            } as unknown as Gap;\n            return [...acc, gap, c];\n          }, [] as Clip[] | Gap[]),\n          effects: Array.from(effects).map((effect): Effect => {\n            return {\n              name: effect.getAttribute('data-effect') ?? '',\n              metadata: {\n                element: effect,\n                selector: finder(effect, {root: s.parentElement as HTMLElement}),\n                data: effect.getAttributeNames().filter(n => n.startsWith('data-')).reduce((acc, n) => ({...acc, [n.replace('data-', '').replace('-', '_')]: effect.getAttribute(n)}), {}),\n              },\n              source_range: {\n                start_time: parseFloat(effect.getAttribute('data-t')?.split(',')[0] ?? '0'),\n                duration: parseFloat(effect.getAttribute('data-t')?.split(',')[1] ?? '0') - parseFloat(effect.getAttribute('data-t')?.split(',')[0] ?? '0'),\n              }\n            } as unknown as Effect;\n          })\n        } as unknown as Clip;\n      }).map((segment) => {\n        segment.metadata.captions = this.getCaptions(segment);\n        segment.metadata.captionsUrl = URL.createObjectURL(new Blob([segment.metadata.captions], { type: \"text/vtt\" }))\n        return segment;\n      }),\n      markers: [],\n      metadata: {},\n      effects: [],\n    } as Track;\n\n    console.log({track: this.track});\n\n\n\n    this._duration = this.track.children.reduce((acc, c) => acc + c.source_range.duration, 0);\n    // this.textTracks = [new TextTrack(this._players)]\n  }\n\n  private getCaptions(segment: Clip): string {\n    const clips = segment.children;\n    const timedTexts = clips.flatMap((c) => c.timed_texts ?? []);\n    const grouped = timedTexts.reduce((acc, obj) => {\n      // Initialize the sub-array for the group if it doesn't exist\n      if (!acc[obj.metadata.captionGroup]) {\n          acc[obj.metadata.captionGroup] = [];\n      }\n      // Append the object to the correct group\n      acc[obj.metadata.captionGroup].push(obj);\n      return acc;\n    }, {} as Record<string, TimedText[]>);\n\n    const captions = Object.values(grouped);\n    console.log({captions});\n\n    const captions2 = captions.reduce((acc, g) => {\n      const p = g.findIndex(t => t.metadata.pilcrow);\n      const p0 = g.findIndex(t => t.metadata.pilcrow0);\n\n      if (p0 < p) {\n        const tail = g.slice(p0 + 1);\n        tail[tail.length - 1].metadata.glue = true;\n        tail[tail.length - 1].metadata.pilcrow = false;\n        tail[tail.length - 1].metadata.pilcrow4 = true;\n        return [...acc, g.slice(0, p0 + 1), tail];\n      }\n      // default\n      return [...acc, g];\n    }, [] as TimedText[][]);\n\n    const captions3 = captions2.reduce((acc, g, i) => {\n      if (i === 0) return [...acc, g];\n      const prev = acc.pop();\n\n      if (prev && prev[prev.length - 1]?.metadata?.glue) {\n        return [...acc, [...prev, ...g]];\n      }\n\n      // default\n      return [...acc, prev, g];\n    }, [] as (TimedText[] | undefined)[]);\n\n    console.log({captions2, captions3});\n\n    const formatSeconds = (seconds: number): string => seconds ? new Date(parseFloat(seconds.toFixed(3)) * 1000).toISOString().substring(11, 23) : '00:00:00:000';\n\n    let vttOut = ['WEBVTT',\n    '',\n    'Kind: captions',\n    'Language: en-US', // TODO lift language from transcript?\n    '',\n    ''].join('\\n');\n    (captions3 as any).forEach((tt: TimedText[], i: number) => {\n      const first = tt[0];\n      const last = tt[tt.length - 1];\n      // let text = tt.map(t => t.texts)\n      const text = tt.map((t) => t.metadata.ruby\n        // + (t.metadata.pilcrow ? '<c.yellow>¶</c>' : '')\n        // + (t.metadata.pilcrow0 ? '<c.yellow>◊</c>' : '')\n        // + (t.metadata.pilcrow2 ? '<c.yellow>†</c>' : '')\n        // + (t.metadata.pilcrow3 ? '<c.yellow>‡</c>' : '')\n        // + (t.metadata.pilcrow4 ? '<c.yellow>⌑</c>' : '')\n        + `<${formatSeconds(t.marked_range.start_time)}>`).join(' ');\n      // const text = tt.map((t) => `<${formatSeconds(t.marked_range.start_time)}>` + '<c>' + t.texts + '</c>' + (t.metadata.pilcrow ? '<c.yellow>¶</c>' : '') + (t.metadata.pilcrow2 ? '<c.yellow>*</c>' : '')).join(' ');\n      const id = `${i}`;\n      vttOut += `${id}\\n${formatSeconds(first?.marked_range?.start_time)} --> ${formatSeconds(last?.marked_range?.start_time + last?.marked_range?.duration)}\\n${text}\\n\\n`;\n    });\n\n    return vttOut;\n  }\n\n  @property({type: String, attribute: 'pause-mutation-observer'})\n  pauseMutationObserver = \"false\";\n\n  public parseTranscript() {\n    const article = document.querySelector(this.transcriptTemplateSelector) as HTMLElement;\n\n    console.log({article});\n\n    if (!article) return;\n    const sections: NodeListOf<HTMLElement> | undefined = article.querySelectorAll('section[data-media-src]');\n    console.log({sections});\n    this._dom2otio(sections);\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  private callback(mutationList: any, _observer: MutationObserver) {\n    if (this.pauseMutationObserver === \"true\") return; // FIXME property should be boolean but in react I get string\n\n    let article;\n    for (const mutation of mutationList) {\n      if (mutation.type === \"childList\") {\n        console.log(\"A child node has been added or removed.\");\n        article = mutation.target;\n      } else if (mutation.type === \"attributes\") {\n        console.log(`The ${mutation.attributeName} attribute was modified.`);\n      }\n    }\n\n    console.log({mutationList, _observer, article: article});\n    if (!article) return;\n    const sections: NodeListOf<HTMLElement> | undefined = article.querySelectorAll('section[data-media-src]');\n    console.log({sections});\n    this._dom2otio(sections);\n  }\n\n  _observer: MutationObserver | undefined = undefined;\n\n\n  // TODO transcriptSelector property\n\n  @property({type: String, attribute: 'player'})\n  playerTemplateSelector = '';\n\n\n  @property({type: String, attribute: 'transcript'})\n  transcriptTemplateSelector = 'article'; // TODO article has section data-t?\n\n  override render() {\n    let overlay;\n    // if (this._clip && (this._clip as Clip).metadata.data.effect) {\n    //   const clip = this._clip as Clip;\n    //   const template = document.createElement('template');\n    //   template.innerHTML = interpolate((document.querySelector<HTMLTemplateElement>(clip.metadata.data.effect)?.innerHTML ?? '').trim(), { src: clip.media_reference.target, ...clip.metadata?.data });\n    //   overlay = template.content.childNodes as NodeListOf<HTMLElement>;\n\n    // }\n    // console.log({overlay, clip: this._clip});\n\n\n    return html`<div>\n      ${this.track ? this.track.children.map((clip, i, arr) => {\n        const offset = arr.slice(0, i).reduce((acc, c) => acc + c.source_range.duration, 0);\n        const duration = clip.source_range.duration;\n\n        const template = document.createElement('template');\n        template.innerHTML = interpolate((document.querySelector<HTMLTemplateElement>(clip.metadata.playerTemplateSelector ?? this.playerTemplateSelector)?.innerHTML ?? '').trim(), {\n          src: clip.media_reference.target,\n          captions: clip.metadata.captionsUrl,\n          ...clip.metadata?.data,\n          width: this.width ?? 'auto',\n          height: this.height ?? 'auto',\n        });\n        const node = template.content.childNodes[0] as HTMLElement;\n        const tag = node.nodeName.toLowerCase();\n        const attrs = Array.from(node.attributes).map((attr) => `${(attr.name)}=${attr.value !== '' ? attr.value : '\"\"' }`);\n        const siblings = Array.from(template.content.childNodes).slice(1);\n\n        const overlays = clip.effects.flatMap((effect) => {\n          const start = effect.source_range.start_time - clip.source_range.start_time + offset;\n          const end = start + effect.source_range.duration;\n          // console.log({start, end, time: this.time});\n          if (start <= this.time && this.time < end) {\n            const progress = (this.time - start) / effect.source_range.duration;\n            const template = document.createElement('template');\n            template.innerHTML = interpolate((document.querySelector<HTMLTemplateElement>(effect.metadata.data.effect)?.innerHTML ?? '').trim(), {progress, ...effect.metadata?.data});\n            return template.content.childNodes as NodeListOf<HTMLElement>;\n          }\n          return null;\n        });\n\n        // if (overlays?.length ?? 0 > 0)\n        // console.log({overlays});\n\n        return html`<div class=${offset <= this.time && this.time < offset + duration ? 'active wrapper' : 'wrapper'} style=\"width: ${this.width ?? 'auto'}px; height: ${this.height ?? 'auto'}px\"><${unsafeStatic(tag)} ${unsafeStatic(attrs.join(' '))}\n            data-t=${`${clip.source_range.start_time},${clip.source_range.start_time + duration}`}\n            data-offset=${offset}\n            _class=${offset <= this.time && this.time < offset + duration ? 'active' : ''}\n            style=\"width: ${this.width}px; height: ${this.height}px\"\n\n            @timeupdate=${this._onTimeUpdate}\n            @canplay=${this._onCanPlay}\n            @play=${this._onPlay}\n            @pause=${this._onPause}\n            @loadedmetadata=${this._onLoadedMetadata}\n\n            @abort=${this._relayEvent}\n            @canplaythrough=${this._relayEvent}\n            @durationchange=${this._relayEvent}\n            @emptied=${this._relayEvent}\n            @ended=${this._relayEvent}\n            @loadeddata=${this._relayEvent}\n            @loadstart=${this._relayEvent}\n            @playing=${this._relayEvent}\n            @progress=${this._relayEvent}\n            @ratechange=${this._relayEvent}\n            @seeked=${this._onSeeked}\n            @seeking=${this._relayEvent}\n            @suspend=${this._relayEvent}\n            @waiting=${this._relayEvent}\n            @error=${this._relayEvent}\n            @volumechange=${this._relayEvent}\n            >\n              <track default kind=\"captions\" srclang=\"en\" src=\"${clip.metadata.captionsUrl}\" />\n              ${node.children}\n            </${unsafeStatic(tag)}>\n            ${siblings}\n            <!-- overlays -->\n            ${overlays}\n          </div>`;\n      }) : null}\n      ${overlay}\n      </div>\n      <div style=\"height: 40px\"></div>\n      <!-- <slot name=\"transcript\" @slotchange=${this.handleSlotchange} @click=${this.handleSlotClick}></slot> -->\n    `;\n  }\n\n  private _countEvent(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    if (this._playersEventsCounter.has(e.target as HTMLMediaElement)) {\n      const eventsCounter = this._playersEventsCounter.get(e.target as HTMLMediaElement) ?? {};\n      const counter = eventsCounter[e.type] ?? 0;\n      this._playersEventsCounter.set(e.target as HTMLMediaElement, {...eventsCounter, [e.type]: counter + 1});\n    } else {\n      this._playersEventsCounter.set(e.target as HTMLMediaElement, {[e.type]: 1});\n    }\n  }\n\n  private _relayEvent(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    this._countEvent(e);\n    console.log(e.type);\n    // this.dispatchEvent(new CustomEvent(e.type));\n  }\n\n  _start = 0;\n  _end = 0;\n\n  private _ready() {\n    // this.dispatchEvent(new CustomEvent('ready'));\n    console.log('ready');\n    const url = new URL(window.location.href);\n    const t = url.searchParams.get('t');\n\n    console.log({t});\n\n    if (t) {\n      const [start, end] = t.split(',').map(v => parseFloat(v));\n\n      this._start = start;\n      this._end = end;\n\n      console.log({_start: this._start, _end: this._end});\n\n      setTimeout(() => {\n        this._seek(start);\n        setTimeout(() => this._playerAtTime(start)?.play(), 1000);\n      }, 1000);\n    } else {\n      this._end = this._duration;\n    }\n  }\n\n  private _onLoadedMetadata(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    this._countEvent(e);\n    // this.dispatchEvent(new CustomEvent(e.type));\n\n    if (this._playersReady.includes(e.target as HTMLMediaElement)) return;\n    this._playersReady.push(e.target as HTMLMediaElement);\n\n    // if all players are ready\n    if (this._playersReady.length === this._players.length) {\n      this._ready();\n    }\n  }\n\n  private _onSeeked(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    this._countEvent(e);\n    const {target: player} = e;\n    const [start, end] = (player.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n    const offset = parseFloat(player.getAttribute('data-offset') ?? '0');\n\n    if (start <= player.currentTime && player.currentTime <= end) {\n      if (this.playing && player.paused && player.currentTime - start + offset === this.time) player.play();\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    // const article = document.getElementById('transcript');\n    const article = document.querySelector(this.transcriptTemplateSelector) as HTMLElement;\n\n    console.log({article});\n\n    if (!article) return;\n    this._observer = new MutationObserver(this.callback.bind(this));\n    this._observer.observe(article, { attributes: true, childList: true, subtree: true });\n\n    const sections: NodeListOf<HTMLElement> | undefined = article.querySelectorAll('section[data-media-src]');\n    console.log({sections});\n    this._dom2otio(sections);\n\n    article.addEventListener('click', this._transcriptClick.bind(this));\n  }\n\n  private _transcriptClick(e: MouseEvent) {\n    const element = e.target as HTMLElement;\n    if (!element || element?.nodeName !== 'SPAN') return;\n\n    console.log({element});\n\n    // const sectionElement = element.parentElement?.parentElement;\n    const sectionElement =  element.closest('section'); // this.parents(element, 'section')[0];\n\n    // console.log({sectionElement});\n\n    const section = this.track?.children.find((c) => c.metadata.element === sectionElement);\n\n    console.log({section});\n    if (!section) return;\n\n    const sectionIndex = this.track?.children.indexOf(section);\n    const offset = this.track?.children.slice(0, sectionIndex).reduce((acc, c) => acc + c.source_range.duration, 0) ?? 0;\n\n    console.log({sectionIndex, offset});\n\n    let start;\n    if (element.getAttribute('data-t')) {\n      const f = (element.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n      start = f[0];\n    } else {\n      start = parseFloat(element.getAttribute('data-m') ?? '') / 1e3;\n    }\n\n    const time = start - section.source_range.start_time + offset;\n\n    console.log(time)\n\n    this._seek(time);\n  }\n\n  private _playerAtTime(time: number): HTMLMediaElement | undefined {\n    const players = Array.from(this._players);\n    return players.find((p) => {\n      const [start, end] = (p.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n      const offset = parseFloat(p.getAttribute('data-offset') ?? '0');\n      return start <= time - offset + start && time - offset + start <= end;\n    });\n  }\n\n  private _currentPlayer(): HTMLMediaElement | undefined {\n    return this._playerAtTime(this.time);\n  }\n\n  private _clipAtTime(time: number): any {\n    if (!this.track) return {};\n\n    const section = this.track.children.find((c, i, arr) => {\n      const offset = arr.slice(0, i).reduce((acc, c) => acc + c.source_range.duration, 0);\n      const start = c.source_range.start_time;\n      const end = c.source_range.start_time + c.source_range.duration;\n      const sourceTime = time - offset + start;\n      return start <= sourceTime && sourceTime <= end;\n    });\n    if (!section) return {};\n\n    const offset = this.track.children.slice(0, this.track.children.indexOf(section)).reduce((acc, c) => acc + c.source_range.duration, 0);\n    const sourceTime = time - offset + section.source_range.start_time;\n\n    const clip = section.children.find((c) => {\n      const start = c.source_range.start_time;\n      const end = c.source_range.start_time + c.source_range.duration;\n      return start <= sourceTime && sourceTime <= end;\n    });\n    if (!clip) return {section, clip: null, timedText: null};\n\n    let timedText = clip.timed_texts?.find((t) => { // find in range\n      const start = t.marked_range.start_time;\n      const end = t.marked_range.start_time + t.marked_range.duration;\n      return start <= sourceTime && sourceTime <= end;\n    })\n\n    const altTimedText = clip.timed_texts?.find((t) => { // find in gap before\n      const start = t.marked_range.start_time;\n      return sourceTime < start;\n    }) ?? [...(clip?.timed_texts ?? [])].reverse().find((t) => { // find in gap after\n      const start = t.marked_range.start_time;\n      return start <= sourceTime;\n    });\n\n    if (!timedText && altTimedText) {\n      // console.log({time, offset, sourceTime, altTimedText});\n      timedText = altTimedText;\n    }\n\n    return {section, clip, timedText};\n  }\n\n  _section = null;\n  @state()\n  _clip = null;\n  _timedText = null;\n  _timedTextTime = 0;\n  _eventCounter = 0;\n  private _dispatchTimedTextEvent(time?: number | undefined) {\n    const {section, clip, timedText} = this._clipAtTime(time ?? this.time);\n    if (!section || !clip) return;\n\n    const sectionIndex = this.track?.children.indexOf(section);\n    const offset = this.track?.children.slice(0, sectionIndex).reduce((acc, c) => acc + c.source_range.duration, 0);\n\n    // if (this._section !== section) {\n    //   this.dispatchEvent(new CustomEvent('playhead', {detail: {section, offset}}));\n    //   this._section = section;\n    // }\n    if (this._clip !== clip) {\n      // this.dispatchEvent(new CustomEvent('playhead', {detail: {clip, section, offset}}));\n      this._clip = clip;\n    }\n    // if (this._timedText !== timedText) {\n    if (this._timedTextTime !== time ?? this.time) {\n        this.dispatchEvent(new CustomEvent('playhead', {\n        bubbles: true,\n        detail: {\n          counter: this._eventCounter++,\n          text: timedText?.texts,\n          time: this.time,\n          offset,\n          pseudo: !!time,\n          pseudoTime: time,\n          transcript: this.transcriptTemplateSelector,\n          media: section.media_reference.target,\n          timedText,\n          clip,\n          section,\n        }\n      }));\n      this._timedText = timedText;\n      this._timedTextTime = time ?? this.time;\n    } else {\n      console.log('same timed text', time ?? this.time);\n    }\n    // TODO emit also source href, such that source pane can be activated and have sync karaoke?\n  }\n\n\n  private _seek(time: number) {\n    const player = this._playerAtTime(time);\n    console.log({time, player});\n    if (!player) return;\n\n    const currentPlayer = this._currentPlayer();\n\n    const [start] = (player.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n    const offset = parseFloat(player.getAttribute('data-offset') ?? '0');\n\n    const playing = !!this.playing;\n    if (playing && currentPlayer && currentPlayer !== player) currentPlayer.pause();\n    player.currentTime = time - offset + start;\n    if (playing && currentPlayer && currentPlayer !== player) this.playing = true;\n  }\n\n\n  _triggerTimeUpdateTimeout = 0;\n  private _triggerTimeUpdate() {\n    clearTimeout(this._triggerTimeUpdateTimeout);\n    if (this.seeking) return;\n\n    const player = this._currentPlayer();\n    if (!player) return;\n\n    player.dispatchEvent(new Event('timeupdate'));\n    if (this.playing) this._triggerTimeUpdateTimeout = setTimeout(() => requestAnimationFrame(this._triggerTimeUpdate.bind(this)), 1000 / 15); // TODO use Clock\n  }\n\n  private _onTimeUpdate(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    this._countEvent(e);\n    if (this.playing && this.seeking) return;\n\n    const {target: player} = e;\n    const [start, end] = (player.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n    const offset = parseFloat(player.getAttribute('data-offset') ?? '0');\n\n    const players = Array.from(this._players);\n    const i = players.indexOf(player as HTMLVideoElement);\n    const nextPlayer = i <= players.length - 1 ? players[i + 1] : null;\n\n    // test for end from media fragment URI\n    if (this._end !== this._duration && this.time >= this._end) player.pause();\n\n    if (player.currentTime < start) {\n      player.currentTime = start;\n      player.pause();\n    } else if (start <= player.currentTime && player.currentTime <= end) {\n      // if (this.playing && player.paused && player.currentTime - start + offset === this.time) player.play();\n      if (player.currentTime !== start) this.time = player.currentTime - start + offset; // FIXME: that \"if\" to avoid 1st seek time update\n      if (nextPlayer) {\n        const [start3] = (nextPlayer.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n        if (nextPlayer.currentTime !== start3) nextPlayer.currentTime = start3;\n      }\n      this.dispatchEvent(new CustomEvent('timeupdate'));\n      this._dispatchTimedTextEvent();\n    } else if (end < player.currentTime) {\n      player.pause();\n      // TEST simulate overlap on clips\n      // setTimeout(() => {\n      //   player.pause();\n      // }, 5000);\n      if (nextPlayer) nextPlayer.play();\n    }\n  }\n\n  private _onCanPlay(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    this._countEvent(e);\n    const {target: player} = e;\n\n    if (player.currentTime > 0) return;\n    const [start] = (player.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n\n    player.currentTime = start;\n  }\n\n  private _onPlay(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    this._countEvent(e);\n    const {target: player} = e;\n    const [start, end] = (player.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n\n    if (start <= player.currentTime && player.currentTime <= end) {\n      this.playing = true;\n      this.dispatchEvent(new CustomEvent('play'));\n    }\n\n    this._triggerTimeUpdate();\n  }\n\n  private _onPause(e: Event & {target: HTMLAudioElement | HTMLVideoElement}) {\n    this._countEvent(e);\n    if (this.seeking) return;\n\n    const {target: player} = e;\n    const [start, end] = (player.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n\n    if (start <= player.currentTime && player.currentTime <= end) {\n      this.playing = false;\n      this.dispatchEvent(new CustomEvent('pause'));\n    }\n  }\n\n  private handleSlotClick(e: MouseEvent & {target: HTMLElement}) {\n    if (e.target.nodeName !== 'SPAN') return;\n    // const [start, end] = (e.target.getAttribute('data-t') ?? '0,0' ).split(',').map(v => parseFloat(v));\n  }\n\n  private handleSlotchange(e: Event & {target: HTMLSlotElement}) {\n    console.log('SLOT CHANGE');\n    const childNodes = e.target.assignedNodes({flatten: true});\n\n    const article = childNodes.find((n) => n.nodeName === 'ARTICLE') as HTMLElement | undefined;\n    if (!article) return;\n\n    this._observer = new MutationObserver(this.callback.bind(this));\n    this._observer.observe(article, { attributes: true, childList: true, subtree: true });\n\n    const sections: NodeListOf<HTMLElement> | undefined = article?.querySelectorAll('section[data-media-src]') ;\n    this._dom2otio(sections);\n  }\n\n\n\n  // protected override createRenderRoot() {\n  //   return this;\n  // }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'timedtext-player': TimedTextPlayer;\n  }\n}\n\n\n\n// TODO move\n// const groupBy = <T>(array: Array<T>, property: (x: T) => string): { [key: string]: Array<T> } =>\n//   array.reduce((memo: { [key: string]: Array<T> }, x: T) => {\n//     if (!memo[property(x)]) {\n//       memo[property(x)] = [];\n//     }\n//     memo[property(x)].push(x);\n//     return memo;\n//   }, {});\n\n\n"]}